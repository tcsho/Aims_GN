<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam DateSheet</title>
    <link rel="icon" type="image/x-icon" href="assets/images/favicon.ico">
    <link rel="stylesheet" href="assets/vendor/Fonts.css" />
    <link rel="stylesheet" href="assets/vendor/CustomStyle.css" />
    <link rel="stylesheet" href="assets/vendor/toastr.css" />
    <link rel="stylesheet" href="assets/vendor/bootstrap/css/bootstrap.css" />
    <link rel="stylesheet" href="assets/vendor/font-awesome/css/font-awesome.css" />
    <link href="assets/vendor/bootstrap.min.css" rel="stylesheet" id="bootstrap-css">

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="Content/jquery.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <!-- <script src="//maxcdn.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script> -->
    <link rel="stylesheet" href="node_modules/ng-select/ng-select/themes/default.theme.css">
   
    <!--Datatables-->

    <link rel="stylesheet" href="Content/DataTables/datatables.min.css" />
    <link href="Content/DataTables/Buttons-1.6.3/css/buttons.dataTables.min.css" rel="stylesheet" />


    <script src="Content/DataTables/Buttons-1.6.3/js/dataTables.buttons.min.js"></script>
    <script src="Content/DataTables/datatables.min.js"></script>
    

    <!--Datatables-->
    
 <link rel="stylesheet" href="node_modules/pnotify/core/dist/PNotify.css">
    <link rel="stylesheet" href="node_modules/pnotify/core/BrightTheme.css">
    <link href="Content/Header_Component.css" rel="stylesheet" />

    <link href="Content/Site.css" rel="stylesheet" />
    <link href="Content/sweetalert2.min.css" rel="stylesheet" />
    <script src="Content/jquery.limitText.js"></script>
</head>

<body>

    <!--HEADER COMPONENT-->
    <div class='overlay'></div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 BackgroundBlue">
                <div class="Gap"></div>
                <div class="row">
                    <div class="col-lg-2 col-md-2 col-sm-12 col-xs-12">
                        <img src="assets/images/logo1.png" class="ImageLayoutCenter" />
                    </div>
                    <div class="col-lg-10 col-md-10 col-sm-12 col-xs-12">
                        <div class="Gap"></div>
                        <div class="Gap"></div>
                        <p class="HeaderHeadingAMISPlus text-lg-left text-md-left text-sm-left text-xs-left text-center">The City School:	Southern Region</p>
                        <div class="row">
                            <nav class="navbar navbar-light navbar-expand-lg mainmenu">
                                <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                                    <span class="navbar-toggler-icon"></span>
                                </button>
                                <div class="collapse navbar-collapse" id="navbarSupportedContent">
                                    <ul class="navbar-nav mr-auto">
                                        <li><a href="#">Home <span class="sr-only">(current)</span></a></li>
                                        <li class="dropdown">
                                            <a class="dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Results</a>
                                            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                                <li><a href="#">Result Card</a></li>
                                            </ul>
                                        </li>
                                        <li class="dropdown">
                                            <a class="dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">TCS Reports</a>
                                            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                                <li class="dropdown">
                                                    <a class="dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Non Academic Reports</a>
                                                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                                        <li><a href="#">Non Academic Reports(RO)</a></li>
                                                        <li><a href="#">Non Academic Reports(CO)</a></li>
                                                    </ul>
                                                </li>
                                                <li class="dropdown">
                                                    <a class="dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Academic Reports</a>
                                                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                                        <li><a href="#">Academic Reports(CO)</a></li>
                                                        <li><a href="#">Academic Reports(RO)</a></li>
                                                    </ul>
                                                </li>
                                            </ul>
                                        </li>

                                        <li class="dropdown">
                                            <a class="dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Component Marks Setup</a>
                                            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                                <li><a href="Unit_Setup.html">Unit/Sub Unit Setup</a></li>
                                                <li><a href="Curriculum_Objectives.html">Curriculum Objectives Setup</a></li>
                                                <li><a href="Cl_Exam.html">CL Exam Setup</a></li>
                                                <li><a href="Comments.html">Comments</a></li>

                                            </ul>
                                        </li>

                                        <li class="dropdown">
                                            <a class="dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Exam Module</a>
                                            <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                                                <li><a href="Mark_Entry.aspx">Marks Entry</a></li>
                                                <li><a href="Progress_Report.html">Subject Progress Report</a></li>
                                                <li><a href="Progress_Report_Class.html">Class Progress Report</a></li>
                                                <li><a href="ExamDate.html">Exam DateSheet</a></li>
                                                <li><a href="Reports.aspx">Reports</a></li>
                                                <li><a href="Printlog.html">Print Log</a></li>
                                            </ul>
                                        </li>


                                        <!-- <li><a href="#">Service</a></li> -->
                                    </ul>
                                </div>
                            </nav>
                        </div>
                    </div>
                    <!--<div class="col-lg-3 col-md-3 col-sm-12 col-xs-12 ">
                        <div class="Gap"></div>
                        <div class="Gap"></div>
                        <p class="HeaderHeadingSubmenu text-lg-right text-md-right text-center">
                            <a href="" class="LogoutButton">
                                Logout &nbsp;&nbsp;&nbsp;<i class="fa fa-sign-out" aria-hidden="true"></i>
                            </a>
                        </p>
                        <div class="Gap"></div>
                        <p class="HeaderHeadingSubmenu text-lg-right text-md-right text-center">
                            Logged in as: <span class="LoginAs"> Sr Exams</span>
                        </p>
                    </div>-->
                </div>
                <div class="Gap"></div>
            </div>
        </div>
    </div>
    <!--HEADER COMPONENT-->

    <div class="container body-content">
        <!--Body-->
        <div class="row">
            <div class="col-lg-12 col-md-12 col-xs-12 col-sm-12" style="box-shadow: 0px 2px 4px -1px #00006a;padding: 7px 40px 40px 40px;">
                <p class="PageMainHeading"><i class="glyphicon glyphicon-folder-open" style="color: #00006a;"></i> &nbsp;&nbsp;Exam DateSheet</p>
                <div style="background-color: #00006a;" class="Gap"></div>

                <form class="form-horizontal product-setup-form custom-form unit_subunitform" autocomplete="off">
                    <p class="PageMainHeading"><span class="PageMainHeadingBorder"> <i class="glyphicon glyphicon-tags" style="color: #00006a;"></i> &nbsp;&nbsp;Header Setup &nbsp;&nbsp;&nbsp;</span> </p>
                    <!-- unitHeaderSetup Start -->
                    <div>
                        <div class="row">

                            <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                                <span class="CustomLabel">Academic Year</span> <span class="RequiredLbl"> * </span><br>

                                <input type="text" class="form-control systopicsno visibilityhidden" />
                                <select class="AcademicYearList form-control">
                                </select>
                                <p class="error-message">* Academic Year Required</p>

                            </div>

                            <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                                <span class="CustomLabel">Term</span> <span class="RequiredLbl"> * </span><br>

                                <select class="Term_list form-control">
                                    <option selected="true" disabled="disabled" value="">---Select---</option>
                                    <option value="1">First Term</option>
                                    <option value="2">Second Term</option>

                                </select>
                                <p class="error-message">* Term Required</p>
                            </div>

                            <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">

                                <span class="CustomLabel">Class</span> <span class="RequiredLbl"> * </span>
                                <select class="Class_list form-control">
                                </select>
                                <p class="error-message">* Class Required</p>
                            </div>

                            <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                                <span class="CustomLabel">Subject</span> <span class="RequiredLbl"> * </span><br>

                                <select class="Subject_list form-control">
                                </select>
                                <p class="error-message">* Subject Required</p>
                            </div>


                            <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                                <span class="CustomLabel">Exam Date</span> <span class="RequiredLbl"> * </span><br>

                                <input type="text" id="datepicker" class="form-control examdate">
                                <p class="error-message">* Date Required</p>
                            </div>

                            <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                                <span class="CustomLabel">Exam Time From</span> <span class="RequiredLbl"> * </span><br>

                                <input type="text" class="form-control bs-timepicker fromtime" /><!---->
                                <p class="error-message">* From Time Required</p>
                            </div>

                            <div class="col-lg-3 col-md-3 col-sm-12 col-xs-12">
                                <span class="CustomLabel">Duration (Min)</span> <span class="RequiredLbl"> * </span><br>

                                <!--<input type="text" class="form-control  tilltime" />-->
                                <input type='number' class='form-control tilltime' placeholder='Duration(Min)' onchange='student_totalmarks(this)' onkeydown='student_totalmarks(this)' onkeyup='student_totalmarks(this)'>
                                <p class="error-message">* Duration Required</p>
                            </div>

                        </div>






                        <!-- unitGroup Start -->
                        <div class="row">



                            <div class="col-sm-12">


                                <button type="button" class=" btn  btn-primary saveunit savebtn" id="saveunit">Save</button>
                                <button type="button" class=" btn  btn-primary updatebtn savebtn" >Update</button>
                                <!--<button type="button" class=" btn  btn-primary viewreport savebtn floatright">Report View</button>-->

                            </div>

                        </div>
                    </div>
                </form>
                <div class="col-lg-12 col-md-12 col-sm-12 col-xs-12 nopadding margintop detail-list">
                   
                </div>
            </div>
        </div>




        <!-- Main Page End   -->
        <link href="Content/jquery-ui.min.css" rel="stylesheet" />
        <script src="Content/jquery-ui.min.js"></script>
        <link href="Content/timepicker.min.css" rel="stylesheet" />
        <script src="Content/timepicker.min.js"></script>

        <!----REPORT PRINT----->
        <!----REPORT PRINT----->
        <script>
            var classId = "";
            var Term_Id = "";
            var Acadmic_Id = "";

            $("#datepicker").datepicker();
            $(function () {
                $(".bs-timepicker").val("08:30");
                $('.bs-timepicker').timepicker();
            });
            var updateflag = 0;
            //var EmployeeCode =@Session["UserID"];
            /********DROPDOWN*****/
            $(".overlay").show();
            var AcademicYearList = "";
            $.ajax({
                type: 'GET',
                //data:,
                url: 'http://localhost:52673/api/Setup/AcademicYearDropDown',//sURLVariableswithurl[0]+"?",//getsearchedpatient
                success: function (result) {
                    AcademicYearList += '<option selected="true" disabled="disabled" value="">---Select---</option>';

                    for (var i = 0; i < result.length; i++) {


                        AcademicYearList += '<option value="' + result[i].Session_Id + '">' + result[i].Description + '</option>';


                    }


                    $(".AcademicYearList").html(AcademicYearList);

                },
                complete: function (result) {

                    $(".overlay").hide();
                },
                error: function (err) {

                    //console.log(JSON.stringify(err));

                }
            });


            var Class_list = "";
            $(".overlay").show();
            $.ajax({
                type: 'GET',
                //data:,
                url: 'http://localhost:52673/api/Setup/ClassDropDown',//sURLVariableswithurl[0]+"?",//getsearchedpatient
                success: function (result) {
                    Class_list += '<option selected="true"  value="">---Select All---</option>';/*disabled="disabled"*/
                    for (var i = 0; i < result.length; i++) {
                        Class_list += '<option value="' + result[i].Class_Id + '">' + result[i].Class_Name + '</option>';
                    }
                    $(".Class_list").html(Class_list);

                },
                complete: function (result) {

                    $(".overlay").hide();
                },
                error: function (err) {

                    //console.log(JSON.stringify(err));

                }
            });
             var termchange=1;
            $(".Class_list").change(function () {
                $(".overlay").show();
                //$(".viewreport").show();
                classId = $(this).val();
                Term_Id = $(".Term_list").val();
                Acadmic_Id = $(".AcademicYearList").val();
                var Subject_list = "";
                $.ajax({
                    type: 'GET',
                    data: { classId: classId },
                    url: 'http://localhost:52673/api/Setup/SubjectByClassIdDropDown',//sURLVariableswithurl[0]+"?",//getsearchedpatient
                    success: function (result) {
                        Subject_list += '<option selected="true" disabled="disabled" value="">---Select---</option>';/**/
                        for (var i = 0; i < result.length; i++) {
                            Subject_list += '<option value="' + result[i].Subject_Id + '">' + result[i].Subject_Name + '</option>';
                        }
                        $(".Subject_list").html(Subject_list);

                    },
                    complete: function (result) {

                        $(".overlay").hide();
                    },
                    error: function (err) {

                        //console.log(JSON.stringify(err));

                    }
                });
            /***GRID**/
                if (classId == "") {
                    termchange = 0;
                }
                else
                {
                    termchange = 1;
                }
                Grid();
                /***Grid**/
            });
           
            $(".Term_list").change(function () {
                termchange = 0;
                /***GRID**/
                Grid();
                /***Grid**/
            });
            /********DROPDOWN*****/




            /********************VALIDATION*******************/
            var AcademicYearListvalidation;
            var TermListvalidation;
            var ClassListvalidation;
            var SubjectListvalidation;
            var Fromtimevalidation;
            var Tilltimevalidation;
            var Examdatevalidation;
            function onlytthreefieldvali() {
                AcademicYearListvalidation = $('.AcademicYearList').val();
                TermListvalidation = $('.Term_list').val();
                ClassListvalidation = $('.Class_list').val();

                $('.AcademicYearList').change("select", function () {
                    $('.AcademicYearList').next(".error-message").hide();
                    $('.AcademicYearList').css('border', 'none');
                    $('.AcademicYearList').css('background', '#d8f9d8');
                });
                if (AcademicYearListvalidation == null || AcademicYearListvalidation == undefined || AcademicYearListvalidation == "" || AcademicYearListvalidation == " ") {
                    $('.AcademicYearList').next(".error-message").text("* Academic Year Required");
                    $('.AcademicYearList').next(".error-message").show();
                    $('.AcademicYearList').css('border', '1px solid red');
                    $('.AcademicYearList').css('background', '#fff');
                    $('.AcademicYearList').focus();
                    return false;
                }
                $('.Term_list').change("select", function () {
                    $('.Term_list').next(".error-message").hide();
                    $('.Term_list').css('border', 'none');
                    $('.Term_list').css('background', '#d8f9d8');
                });
                if (TermListvalidation == null || TermListvalidation == undefined || TermListvalidation == "" || TermListvalidation == " ") {
                    $('.Term_list').next(".error-message").text("* Term Required");
                    $('.Term_list').next(".error-message").show();
                    $('.Term_list').css('border', '1px solid red');
                    $('.Term_list').css('background', '#fff');
                    $('.Term_list').focus();
                    return false;
                }
                $('.Class_list').change("select", function () {
                    $('.Class_list').next(".error-message").hide();
                    $('.Class_list').css('border', 'none');
                    $('.Class_list').css('background', '#d8f9d8');
                });
                if (ClassListvalidation == null || ClassListvalidation == undefined || ClassListvalidation == "" || ClassListvalidation == " ") {
                    $('.Class_list').next(".error-message").text("* Class Required");
                    $('.Class_list').next(".error-message").show();
                    $('.Class_list').css('border', '1px solid red');
                    $('.Class_list').css('background', '#fff');
                    $('.Class_list').focus();
                    return false;
                }


            }

            function validation() {
                AcademicYearListvalidation = $('.AcademicYearList').val();
                TermListvalidation = $('.Term_list').val();
                ClassListvalidation = $('.Class_list').val();
                SubjectListvalidation = $('.Subject_list').val();
                Fromtimevalidation = $('.fromtime').val();
                Tilltimevalidation = $('.tilltime').val();
                Examdatevalidation = $(".examdate").val();
                $('.AcademicYearList').change("select", function () {
                    $('.AcademicYearList').next(".error-message").hide();
                    $('.AcademicYearList').css('border', 'none');
                    $('.AcademicYearList').css('background', '#d8f9d8');
                });
                if (AcademicYearListvalidation == null || AcademicYearListvalidation == undefined || AcademicYearListvalidation == "" || AcademicYearListvalidation == " ") {
                    $('.AcademicYearList').next(".error-message").text("* Academic Year Required");
                    $('.AcademicYearList').next(".error-message").show();
                    $('.AcademicYearList').css('border', '1px solid red');
                    $('.AcademicYearList').css('background', '#fff');
                    $('.AcademicYearList').focus();
                    return false;
                }
                $('.Term_list').change("select", function () {
                    $('.Term_list').next(".error-message").hide();
                    $('.Term_list').css('border', 'none');
                    $('.Term_list').css('background', '#d8f9d8');
                });
                if (TermListvalidation == null || TermListvalidation == undefined || TermListvalidation == "" || TermListvalidation == " ") {
                    $('.Term_list').next(".error-message").text("* Term Required");
                    $('.Term_list').next(".error-message").show();
                    $('.Term_list').css('border', '1px solid red');
                    $('.Term_list').css('background', '#fff');
                    $('.Term_list').focus();
                    return false;
                }
                $('.Class_list').change("select", function () {
                    $('.Class_list').next(".error-message").hide();
                    $('.Class_list').css('border', 'none');
                    $('.Class_list').css('background', '#d8f9d8');
                });
                if (ClassListvalidation == null || ClassListvalidation == undefined || ClassListvalidation == "" || ClassListvalidation == " ") {
                    $('.Class_list').next(".error-message").text("* Class Required");
                    $('.Class_list').next(".error-message").show();
                    $('.Class_list').css('border', '1px solid red');
                    $('.Class_list').css('background', '#fff');
                    $('.Class_list').focus();
                    return false;
                }

                $('.Subject_list').on("input", function () {
                    $('.Subject_list').next(".error-message").hide();
                    $('.Subject_list').css('border', 'none');
                    $('.Subject_list').css('background', '#d8f9d8');
                });
                if (SubjectListvalidation == null || SubjectListvalidation == undefined || SubjectListvalidation == "" || SubjectListvalidation == " ") {
                    $('.Subject_list').next(".error-message").text("* Subject Required");
                    $('.Subject_list').next(".error-message").show();
                    $('.Subject_list').css('border', '1px solid red');
                    $('.Subject_list').css('background', '#fff');
                    $('.Subject_list').focus();
                    return false;
                }
                $('.fromtime').on("input", function () {
                    $('.fromtime').next(".error-message").hide();
                    $('.fromtime').css('border', 'none');
                    $('.fromtime').css('background', '#d8f9d8');
                });
                if (Fromtimevalidation == null || Fromtimevalidation == undefined || Fromtimevalidation == "" || Fromtimevalidation == " ") {
                    $('.fromtime').next(".error-message").text("* From Time Required");
                    $('.fromtime').next(".error-message").show();
                    $('.fromtime').css('border', '1px solid red');
                    $('.fromtime').css('background', '#fff');
                    $('.fromtime').focus();
                    return false;
                }
                $('.tilltime').on("input", function () {
                    $('.tilltime').next(".error-message").hide();
                    $('.tilltime').css('border', 'none');
                    $('.tilltime').css('background', '#d8f9d8');
                });
                if (Tilltimevalidation == null || Tilltimevalidation == undefined || Tilltimevalidation == "" || Tilltimevalidation == " ") {
                    $('.tilltime').next(".error-message").text("* Duration Required");
                    $('.tilltime').next(".error-message").show();
                    $('.tilltime').css('border', '1px solid red');
                    $('.tilltime').css('background', '#fff');
                    $('.tilltime').focus();
                    return false;
                }

                $('.examdate').on("input", function () {
                    $('.examdate').next(".error-message").hide();
                    $('.examdate').css('border', 'none');
                    $('.examdate').css('background', '#d8f9d8');
                });
                if (Examdatevalidation == null || Examdatevalidation == undefined || Examdatevalidation == "" || Examdatevalidation == " ") {
                    $('.examdate').next(".error-message").text("* Exam Date Required");
                    $('.examdate').next(".error-message").show();
                    $('.examdate').css('border', '1px solid red');
                    $('.examdate').css('background', '#fff');
                    $('.examdate').focus();
                    return false;
                }




            }
            /*******************VALIDATION********************/

            $("#saveunit").click(function () {
                if (validation() == false) {

                    return;
                }
                else {

                    var deliveryArr = [];
                    //var transaction_main = [];
                    deliveryArr.length = 0;
                  

                    deliveryArr.push({


                        Class_Id: ClassListvalidation,

                        Subject_Id: SubjectListvalidation,
                        ExamDate: Examdatevalidation,
                        TimeFrom: Fromtimevalidation,
                        TimeTill: Tilltimevalidation
                    });

                    var dataadd = JSON.stringify({



                        Session_Id: AcademicYearListvalidation,
                        TermGroup_Id: TermListvalidation,
                        DateSheetDetails: deliveryArr


                    });


                    //var dataupdate = JSON.stringify({

                    //    Sys_TopicSno: $(".systopicsno").val(),
                    //    //Subject_Topic: transaction_main,
                    //    Session_Id: AcademicYearListvalidation,
                    //    Class_Id: ClassListvalidation,
                    //    Subject_Id: SubjectListvalidation,
                    //    Topic_Name: $('.Unit_Name').val(),
                    //    //EmployeeCode:EmployeeCode,
                    //    Subject_SubTopic: deliveryArr


                    //});

                    if (updateflag == 0) {

                        $.when(saveOrder(dataadd)).then(function (response) {
                            //console.log("RESPONSESSS" + response);
                        }).fail(function (err) {
                            alert("ERORRRR" + err);
                        });





                    }
                    else {
                        $.when(updateOrder(dataupdate)).then(function (response) {
                            //console.log("RESPONSESSS" + response);
                        }).fail(function (err) {
                            //alert("ERORRRR" + err);
                            Swal.fire(
                                'Delete Objective & Papersetting!',
                                '',
                                'error'
                            )
                        });
                    }

                    function saveOrder(dataadd) {
                        
                        $('.overlay').show();

                         $.ajax({
                    type: 'GET',
                    data: { Session_Id: AcademicYearListvalidation,Class_Id: ClassListvalidation,TermGroup_Id: TermListvalidation,Subject_Id: SubjectListvalidation},
                    url: 'http://localhost:52673/api/Setup/CheckDateSheet',//sURLVariableswithurl[0]+"?",//getsearchedpatient
                    success: function (result) {
                        if (result == null || result == "" || result == " ") {
                            return $.ajax({
                            contentType: 'application/json; charset=utf-8',
                            type: 'POST',
                            data: dataadd,
                            dataType: 'json',

                            url: 'http://localhost:52673/api/Setup/CreateDateSheet',
                            success: function (result) {
                                //alert("save");
                                Swal.fire(
                                    'Save Successfuly!',
                                    '',
                                    'success'
                                ).then(function () {
                                      Grid();
                                    //resetaddmodel();
                                    //fabrictable();
                                    //location.reload();
                                });
                                //alert("Save");

                            },
                            complete: function () {
                               
                                $('.overlay').hide();
                            },
                            error: function () {
                                alert("error");
                            }
                        });
                        }
                        else
                        {
                            Swal.fire(
                                'Already Exist!',
                                '',
                                'error'
                            )
                        }

                    },
                    complete: function (result) {

                        $(".overlay").hide();
                    },
                    error: function (err) {

                        console.log(JSON.stringify(err));

                    }
                         });
                     



                        
                        
                    }

                    /************UPDATE**********/
                    
                    /**************UPDATE***************/
                }
            });

            /*****RESET PARENT AND CHILD*********/



            /****UPDATE FILLING */
            $(".Subject_list").change(function () {


                if (onlytthreefieldvali() == false) {
                    $(".Subject_list").val("");
                    return;
                }
                else {
                    $(".overlay").hide();
                    // alert("academic"+AcademicYearListvalidation);
                    var subj = $(this).val();
                    $.ajax({
                        type: 'GET',
                        data: { Session_Id: AcademicYearListvalidation, Class_Id: ClassListvalidation, Subject_Id: subj },
                        url: 'http://localhost:52673/api/Setup/UnitSetupById',//http://localhost:52673/api/Setup/ObjectiveDropDownBysubjectsessionclassid

                        success: function (result) {
                            if (result == null || result == "" || result == " ") {




                                $(".saveunit").text("Save");
                                updateflag = 0;

                            }

                            else {

                            }

                        },
                        complete: function (result) {

                            $(".overlay").hide();
                        },
                        error: function (err) {

                            //console.log(JSON.stringify(err));

                        }
                    });
                }
            });

            /*****Update fillling */



            function fetchtopicid(topicid) {

                $.ajax({
                    type: 'GET',
                    data: { topicId: topicid },
                    url: 'http://localhost:52673/api/Setup/TopicById',//sURLVariableswithurl[0]+"?",//getsearchedpatient
                    success: function (result) {
                        $("#detailTableadd tbody").html("");
                        var productItemupdate = "";
                        for (var i = 0; i < result.length; i++) {

                            $(".Unit_Name").val(result[0].Topic_Name);
                            for (var i = 0; i < result[0].SubTopic.length; i++) {


                                productItemupdate += '<tr><td><div class="inner-addon left-addon">';
                                productItemupdate += '<i class="glyphicon glyphicon-book" style="color: #00006a;"></i>';
                                productItemupdate += '<input type="text" class="form-control UnitNameobjval" placeholder="Please enter"  formControlName="Topic_Name" value="' + result[0].SubTopic[i].Sub_TopicName + '"/>';
                                productItemupdate += '</div></td>';
                                productItemupdate += '<td class="text-center"><a data-itemId="0" href="#" class="deleteaddItem btn btn-sm btn-danger"><span class="glyphicon glyphicon-trash"> </span></a></td></tr>';



                            }
                            $("#detailTableadd tbody").html(productItemupdate);
                            $(".saveunit").text("Update");
                            $(".systopicsno").val(topicid);
                            updateflag = 1;
                        }
                    }

                });


            }

            function resetaddmodel() {
                //$(".unit_subunitform input").val("");
                // $(".unit_subunitform input").css("border:1px solid #ced4da;background:#fff;");
                //$(".unit_subunitform select").val("");
                //$(".unit_subunitform select").css("border:1px solid #ced4da;background:#fff;");
                $(".unit_subunitform .Unit_Name").val("");
                $(".unit_subunitform .UnitNameobj").val("");
                $(".systopicsno").val("");
                $("#detailTableadd tbody").html("");
                $(".detail-list tbody").html("");
                $(".saveunit").text("Save");
                updateflag = 0;
                $(".addunitcheck").prop("checked", false);

            }





            $(".viewreport").click(function () {
                //alert(Acadmic_Id + "" + Term_Id + "" + classId);
                //window.location.href = "http://localhost:52673/ReportCard/DateSheet.html?Session_Id=" +Acadmic_Id+"&TermGroup_Id="+Term_Id+"&Class_Id=" + classId;
               
                window.open("http://localhost:52673/ReportCard/DateSheet.html?Session_Id=" + Acadmic_Id + "&TermGroup_Id=" + Term_Id, '_blank');



            });
            function minsplit(vmins) {

                var min_res = vmins.split(":");
                return min_res[1];
            }


            function student_totalmarks(itemu) {

                var total_mark_Papers = 300;
                if ($(itemu).val() > parseInt(total_mark_Papers))
                //&& e.keyCode !== 46
                //&& e.keyCode !== 8
                {
                    //preventDefault();
                    $(itemu).val("");
                    $(itemu).next(".error-message").text("* Duration Excessed");
                    $(itemu).next(".error-message").show();
                    $(itemu).css('border', '1px solid red');
                    $(itemu).css('background', '#fff');
                    $(itemu).focus();
                    return;
                }
                if ($(itemu).val() < 1)
                //&& e.keyCode !== 46
                //&& e.keyCode !== 8
                {
                    //preventDefault();
                    $(itemu).val("");
                    $(itemu).next(".error-message").text("* Duration Not Less Than 1");
                    $(itemu).next(".error-message").show();
                    $(itemu).css('border', '1px solid red');
                    $(itemu).css('background', '#fff');
                    $(itemu).focus();
                    return;
                }
                else {
                    $(itemu).next(".error-message").hide();
                    $(itemu).css('border', 'none');
                    $(itemu).css('background', '#d8f9d8');
                }
                return;
            }



            /******UPDATE FETCH***/
            var dateid = "";
            function UpdateDate(items) {
                $(".saveunit").hide();
                $(".updatebtn").show();


                var $row = $(items).closest("tr");

                    /****VALIDATION ****/
               dateid = $row.find(".dateid").text();
                var termgrpid = $row.find(".termgrpid").text();
                var class_id = $row.find(".class_id").text();  
                var subj_id = $row.find(".subj_id").text();       
                var exams_dates = $row.find(".exams_dates").text();    
                var exams_timefrom = $row.find(".exams_timefrom").text(); 
                var exams_dura = $row.find(".exams_dura").text();  
                var sessid= $row.find(".sessid").text();


                 var Subject_list = "";
                $.ajax({
                    type: 'GET',
                    data: { classId: class_id },
                    async:false,
                    url: 'http://localhost:52673/api/Setup/SubjectByClassIdDropDown',//sURLVariableswithurl[0]+"?",//getsearchedpatient
                    success: function (result) {
                        Subject_list += '<option selected="true" disabled="disabled" value="">---Select---</option>';/**/
                        for (var i = 0; i < result.length; i++) {
                            Subject_list += '<option value="' + result[i].Subject_Id + '">' + result[i].Subject_Name + '</option>';
                        }
                        $(".Subject_list").html(Subject_list);

                    },
                    complete: function (result) {

                        $(".overlay").hide();
                    },
                    error: function (err) {

                        //console.log(JSON.stringify(err));

                    }
                });



                termgrpid = $(".Term_list").val(termgrpid);
                class_id = $(".Class_list").val(class_id);  
                subj_id = $(".Subject_list").val(subj_id);       
                exams_dates = $(".examdate").val(exams_dates);    
               exams_timefrom = $(".fromtime").val(exams_timefrom); 
                exams_dura = $(".tilltime").val(exams_dura); 
                sessid= $(".AcademicYearList").val(sessid); 
            }
            /******UPDATE FETCH***/

            /**UPDATE**/
            $(".updatebtn").click(function () {
                if (validation() == false) {

                    return;
                }
                else {

                    var updateArr = [];

                    updateArr.length = 0;


                    updateArr.push({

                        //DateSheetMasterId: dateid,
                        Class_Id: ClassListvalidation,

                        Subject_Id: SubjectListvalidation,
                        ExamDate: Examdatevalidation,
                        TimeFrom: Fromtimevalidation,
                        TimeTill: Tilltimevalidation
                    });

                    var dataupdate = JSON.stringify({


                        Id: dateid,//dateid,
                        Session_Id: AcademicYearListvalidation,
                        TermGroup_Id: TermListvalidation,
                        DateSheetDetails: updateArr


                    });

                    $.when(updateOrder(dataupdate)).then(function (response) {
                        //console.log("RESPONSESSS" + response);
                    }).fail(function (err) {
                        //alert("ERORRRR" + err);
                        Swal.fire(
                            'Not Updating!',
                            '',
                            'error'
                        )
                    });




                    /************UPDATE**********/
                    function updateOrder(dataupdate) {
                         $('.overlay').show();
                        return $.ajax({
                            contentType: 'application/json; charset=utf-8',
                            type: 'PUT',
                            data: dataupdate,//, dateid: dateid 

                            dataType: 'json',

                            url: 'http://localhost:52673/api/Setup/UpdateDateSheet',
                            success: function (result) {
                                //alert("save");
                                Swal.fire(
                                    'Update Successfuly!',
                                    '',
                                    'success'
                                ).then(function () {
                                    $(".updatebtn").hide();
                                   $(".saveunit").show();
                                    Grid();
                                    //resetaddmodel();
                                    //fabrictable();
                                    // location.reload();
                                });
                                //alert("Save");

                            },
                            complete: function () {
                                
                                 $('.overlay').hide();
                            },
                            error: function () {
                                // alert("error");
                                Swal.fire(
                                    'Delete Objective & Papersetting!',
                                    '',
                                    'error'
                                )
                            }
                        });
                    }
                    /**************UPDATE***************/
                }
            });
            /**UPDATE**/
            /***DELETE ***/
            function DeleteDate(items) {
              
                var $row = $(items).closest("tr");

                /****VALIDATION ****/
                var fellowId = $row.find(".dateid").text();

                Swal.fire({
            title: 'Are you sure?',
            text: "You won't be able to revert this!",
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#3085d6',
            confirmButtonText: 'Yes, delete it!'
        }).then((result) => {
            if (result.value) {
                   $('.overlay').show();
                $.ajax({
                    //contentType: 'application/json; charset=utf-8',
                    //type: 'DELETE',
                    //data: { fellowId: fellowId },
                    //dataType: "json",
                    url: 'http://localhost:52673/api/Setup/Deletefellow?fellowId=' + fellowId,
                    //headers: {
                    //        "accept": "application/json",
                    //        "Access-Control-Allow-Origin":"*"
                    //},
                    type: 'DELETE',
                    success: function (result) {
                        //alert("save");
                        $(items).parents('tr').css("background-color", "#f4f7f6").fadeOut(800, function () {
                            $(this).remove();
                        });

                        Swal.fire(
                            'Delete Successfuly!',
                            '',
                            'success'
                        ).then(function () {
                            //$(".updatebtn").hide();
                            //$(".saveunit").show();
                            Grid();
                            //resetaddmodel();
                            //fabrictable();
                            // location.reload();
                        });
                        //alert("Save");

                    },
                    complete: function () {

                        $('.overlay').hide();
                    },
                    error: function (err) {
                        alert(JSON.stringify(err));

                    }

                });
            }
            });

        //        Swal.fire({
        //    title: 'Are you sure?',
        //    text: "You won't be able to revert this!",
        //    icon: 'warning',
        //    showCancelButton: true,
        //    confirmButtonColor: '#d33',
        //    cancelButtonColor: '#3085d6',
        //    confirmButtonText: 'Yes, delete it!'
        //}).then((result) => {
        //    if (result.value) {

        //         $('.overlay').show();
        //        /**DELETE**/
        //            }
        //});
      //          var settings = {
      //    'cache': false,
      //    'dataType': "jsonp",
      //    "async": true,
      //              "crossDomain": true,
      //      "data": { fellowId: fellowId },
      //              "url": "http://localhost:52673/api/Setup/Deletefellow",
         
      //    "method": "GET",
      //    "headers": {
      //        "accept": "application/json",
      //        "Access-Control-Allow-Origin":"*"
      //    }
      //}

      //$.ajax(settings).done(function (response) {
      //    console.log(response);

      //});


            }
             /***DELETE ***/

            /****GRID TABLE */
            function Grid() {
                if (termchange == 0 && classId=="") {
                    
                    classId = 0
                }
                else
                {
                    classId = $(".Class_list").val();
                }
                //classId = $(".Class_list").val();
                Term_Id = $(".Term_list").val();
                Acadmic_Id = $(".AcademicYearList").val();
                
                 //$('.detail-list').DataTable().destroy();
                
                $(".detail-list").html("");
                var topic_list = "";
                $.ajax({
                    type: 'GET',
                    data: { Session_Id: Acadmic_Id, TermGroup_Id: Term_Id, Class_Id: classId },
                    url: 'http://localhost:52673/api/Setup/DateSheetShow',//sURLVariableswithurl[0]+"?",//getsearchedpatient
                    success: function (result) {

                        topic_list += '<table class="table detail-list_table">';
                        topic_list += '<thead>';
                        topic_list += '<tr>';
                                topic_list += '<th class="visibilityhidden">ID</th>';
                                topic_list += '<th>Academic</th>';
                                topic_list += '<th>Class</th>';
                                topic_list += '<th>Subject</th>';
                                topic_list += '<th>Exam</th>';
                                topic_list += '<th>From</th>';
                                topic_list += '<th>Duration (Min)</th>';
                                topic_list += '<th>Action</th>';
                            topic_list += '</tr>';
                        topic_list += '</thead>';
                      
                        
                    
                          topic_list += '<tbody>';
                        for (var i = 0; i < result.length; i++) {



                            topic_list += '<tr>';
                           
                            topic_list += '<td class="visibilityhidden"><span class="dateid">' + result[i].Id + '</span><span class="termgrpid">' + result[i].TermGroup_Id + '</span><span class="sessid">' + result[i].Session_Id + '</span><span class="class_id">'+result[i].Class_Id+'</span><span class="subj_id">'+result[i].Subject_Id+'</span><span class="exams_dates">'+result[i].ExamDate+'</span></td>';
                            topic_list += '<td>' + result[i].Description + '</td>';
                            topic_list += '<td>' + result[i].Class_Name + '</td>';
                            topic_list += '<td>'+ result[i].Subject_Name + '</td>';
                            topic_list += '<td>' + stringtodate(result[i].ExamDate) +'</td>';
                            topic_list += '<td class="exams_timefrom">' + result[i].TimeFrom + '</td>';
                            topic_list += '<td class="exams_dura">' + result[i].TimeTill + '</td>';
                            topic_list += '<td><button type="button" class="savestudent btn btn-primary" onClick="UpdateDate(this)">Edit</button>';
                            topic_list += '<button type="button" class="savestudent btn btn-primary" onClick="DeleteDate(this)">Delete</button>';
                            topic_list += '</td>';
                            topic_list += '</tr>';
                        }
                        topic_list += '</tbody>';
                        topic_list += '</table>';


                     $('.detail-list_table').DataTable().destroy();
                        $(".detail-list").html(topic_list);
                       
                        
                     
                        //$(".detail-list").DataTable().fnDestroy();
                        
                       
                        //$('.detail-list').empty();
                            /***DATATABLE***/
                            $('.detail-list_table').DataTable({
                                "dom": 'Blfrtip',
                                //"retrieve": true,
                                //"processing": true, //Optional, only useful for *large* tables
                                //"serverSide": true,
                                //"bPaginate": true,
                                //"bLengthChange": true,
                                //"bFilter": true,
                                //"bInfo": true,
                                //"buttons": [
                                //    "copy", "excel"
                                //],

                                buttons: [
                                    {
                                        extend: 'excel',
                                        exportOptions: {
                                            columns: [1, 2, 3, 4, 5, 6]
                                        }
                                    }
                                ],
                                "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]],
                                


                            });
                            /**DATATABLE***/
                        
                        //{
                        //                    "dom": 'Blfrtip',
                        //                    "bPaginate": true,
                        //                    "bLengthChange": true,
                        //                    "bFilter": true,
                        //                    "bInfo": true,
                        //                    "buttons": [
                        //                   "copy", "excel", "pdf"
                        //                ],
                        //                    "lengthMenu": [[10, 25, 50, -1], [10, 25, 50, "All"]]

                        //                }

                    },
                    complete: function (result) {

                        $(".overlay").hide();
                    },
                    error: function (err) {

                        //console.log(JSON.stringify(err));

                    }
                });
            }

            /****GRID TABLE */

         


            /**string date format**/
            function stringtodate(str) {

                const months = ["null", "Jan", "Feb", "Mar", "Apr", "May", "Jun",
                    "Jul", "Aug", "Sep", "Oct", "Nov", "Dec"
                ];

                var res = str.split("/");
                var month = res[0];

                var monthfirstcheck = res[0].slice(0, 1);
                if (monthfirstcheck == 0) {
                    month = res[0].replace("0", "")
                }
                month = parseInt(month);


                var date = res[1];

                var year = res[2];
                //console.log(months[month] + " " + date + "," + " " + year);
                var strdate = months[month] + " " + date + "," + " " + year;
                return strdate;

            }
            /**string date format**/
        </script>
        <style>
            .viewreport {
                display: none;
            }

            .margintop {
                margin-top: 10px;
            }

            .floatright {
                float: right;
            }
            .updatebtn {
            display:none;
            }
            .ui-icon-circle-triangle-e {
    background-position: inherit !important;
}
            /*.ui-widget-header .ui-icon {
    background-image: url(Content/images/ui-icons_444444_256x240.png) !important;

}*/
            a.ui-datepicker-prev.ui-corner-all {
    background: url(Content/images/left-arrow.png) !important;
    background-repeat: no-repeat !important;
    position: absolute;
    top: 6px;
}
                        a.ui-datepicker-next.ui-corner-all {
    background: url(Content/images/right-arrow.png) !important;
    background-repeat: no-repeat !important;
    position: absolute;
    top: 6px;
}
        </style>
        <!--Body-->
        <hr />
        <footer>
            <p>&copy; 2021 - The City School</p>
        </footer>
    </div>


    <script src="Content/sweetalert2.min.js"></script>

   
</body>
</html>
